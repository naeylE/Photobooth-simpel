<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Simple Photobooth</title>

<style>
  body{
    font-family:sans-serif;
    background:#e5f4ff;
    display:flex;
    justify-content:center;
    padding:20px;
  }
  .container{
    width:350px;
    background:white;
    border-radius:12px;
    padding:15px;
    box-shadow:0 6px 20px rgba(0,0,0,0.15);
    text-align:center;
  }
  video{
    width:100%;
    border-radius:10px;
    transform: scaleX(-1); /* biar mirror */
  }
  #overlayPreview{
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    object-fit:contain;
    pointer-events:none;
  }
  .overlay-grid{
    margin-top:12px;
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:8px;
  }
  .overlay-grid img{
    width:100%;
    height:70px;
    object-fit:cover;
    border-radius:8px;
    cursor:pointer;
    border:2px solid transparent;
  }
  .overlay-grid img.active{
    border-color:limegreen;
  }
  button{
    margin-top:12px;
    background:#a5e7a0;
    border:0;
    padding:10px;
    border-radius:8px;
    cursor:pointer;
    width:100%;
  }
</style>

</head>
<body>

<div class="container">
  <div style="position:relative;">
    <video id="video" autoplay playsinline></video>
    <img id="overlayPreview" src="">
  </div>

  <div class="overlay-grid" id="overlayGrid"></div>

  <button id="captureBtn">Capture</button>

  <canvas id="canvas" style="display:none;"></canvas>
</div>

<script>
const video = document.getElementById("video");
const overlayPreview = document.getElementById("overlayPreview");
const canvas = document.getElementById("canvas");
const overlayGrid = document.getElementById("overlayGrid");

// folder kamu = overlys
const overlays = [
  "overlys/1.png",
  "overlys/2.png",
  "overlys/3.png",
  "overlys/4.png",
  "overlys/5.png",
  "overlys/6.png",
];

let currentOverlay = "";

// tampilkan grid overlay
overlays.forEach(src => {
  const img = document.createElement("img");
  img.src = src;
  img.onclick = () => {
    document.querySelectorAll(".overlay-grid img").forEach(i => i.classList.remove("active"));
    img.classList.add("active");
    currentOverlay = src;
    overlayPreview.src = src;
  };
  overlayGrid.appendChild(img);
});

// hidupkan kamera
async function startCam(){
  try {
    const stream = await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject = stream;
  } catch(err) {
    alert("Gagal akses kamera: " + err);
  }
}
startCam();

// capture
document.getElementById("captureBtn").onclick = async () => {
  if(!video.videoWidth) return;

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  let ctx = canvas.getContext("2d");

  // gambar video (flip mirror)
  ctx.save();
  ctx.scale(-1,1);
  ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
  ctx.restore();

  // tambahkan overlay
  if(currentOverlay){
    const img = new Image();
    img.src = currentOverlay;
    await new Promise(res => img.onload = res);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  }

  // download hasilnya
  const data = canvas.toDataURL("image/png");
  const link = document.createElement("a");
  link.href = data;
  link.download = "photo.png";
  link.click();
};
</script>

</body>
</html>
